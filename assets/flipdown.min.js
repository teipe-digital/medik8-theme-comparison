"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o,s=0;s<e.length;s++)(o=e[s]).enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}var FlipDown=function(){var t=Math.floor;function e(t){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"flipdown",s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(_classCallCheck(this,e),"number"!=typeof t)throw Error("FlipDown: Constructor expected unix timestamp, got ".concat(_typeof(t)," instead."));"object"===_typeof(o)&&(s=o,o="flipdown"),this.version="0.3.2",this.initialised=!1,this.now=this._getTime(),this.epoch=t,this.countdownEnded=!1,this.hasEndedCallback=null,this.element=document.getElementById(o),this.rotors=[],this.rotorLeafFront=[],this.rotorLeafRear=[],this.rotorTops=[],this.rotorBottoms=[],this.countdown=null,this.daysRemaining=0,this.clockValues={},this.clockStrings={},this.clockValuesAsString=[],this.prevClockValuesAsString=[],this.opts=this._parseOptions(s),this._setOptions()}return _createClass(e,[{key:"start",value:function t(){return this.initialised||this._init(),this.countdown=setInterval(this._tick.bind(this),1e3),this}},{key:"ifEnded",value:function t(e){return this.hasEndedCallback=function(){e(),this.hasEndedCallback=null},this}},{key:"_getTime",value:function t(){return new Date().getTime()/1e3}},{key:"_hasCountdownEnded",value:function t(){return 0>this.epoch-this.now?(this.countdownEnded=!0,null!=this.hasEndedCallback&&(this.hasEndedCallback(),this.hasEndedCallback=null),!0):(this.countdownEnded=!1,!1)}},{key:"_parseOptions",value:function t(e){var o=["Days","Hours","Minutes","Seconds"];return e.headings&&4===e.headings.length&&(o=e.headings),{theme:e.hasOwnProperty("theme")?e.theme:"dark",headings:o}}},{key:"_setOptions",value:function t(){this.element.classList.add("flipdown__theme-".concat(this.opts.theme))}},{key:"_init",value:function e(){this.initialised=!0,this.daysremaining=this._hasCountdownEnded()?0:t((this.epoch-this.now)/86400).toString().length;for(var o=2>=this.daysremaining?2:this.daysremaining,s=0;s<o+6;s++)this.rotors.push(this._createRotor(0));for(var i=[],s=0;s<o;s++)i.push(this.rotors[s]);this.element.appendChild(this._createRotorGroup(i,0));for(var n,r=o,s=0;3>s;s++){n=[];for(var a=0;2>a;a++)n.push(this.rotors[r]),r++;this.element.appendChild(this._createRotorGroup(n,s+1))}return this.rotorLeafFront=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-leaf-front")),this.rotorLeafRear=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-leaf-rear")),this.rotorTop=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-top")),this.rotorBottom=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-bottom")),this._tick(),this._updateClockValues(!0),this}},{key:"_createRotorGroup",value:function t(e,o){var s=document.createElement("div");s.className="rotor-group";var i=document.createElement("div");return i.className="rotor-group-heading",i.setAttribute("data-before",this.opts.headings[o]),s.appendChild(i),appendChildren(s,e),s}},{key:"_createRotor",value:function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,o=document.createElement("div"),s=document.createElement("div"),i=document.createElement("figure"),n=document.createElement("figure"),r=document.createElement("div"),a=document.createElement("div");return o.className="rotor",s.className="rotor-leaf",i.className="rotor-leaf-rear",n.className="rotor-leaf-front",r.className="rotor-top",a.className="rotor-bottom",i.textContent=e,r.textContent=e,a.textContent=e,appendChildren(o,[s,r,a]),appendChildren(s,[i,n]),o}},{key:"_tick",value:function e(){this.now=this._getTime();var o=0>=this.epoch-this.now?0:this.epoch-this.now;this.clockValues.d=t(o/86400),o-=86400*this.clockValues.d,this.clockValues.h=t(o/3600),o-=3600*this.clockValues.h,this.clockValues.m=t(o/60),o-=60*this.clockValues.m,this.clockValues.s=t(o),this._updateClockValues(),this._hasCountdownEnded()}},{key:"_updateClockValues",value:function t(){function e(){var t=this;this.rotorTop.forEach(function(e,o){e.textContent!=t.clockValuesAsString[o]&&(e.textContent=t.clockValuesAsString[o])})}function o(){var t=this;this.rotorLeafRear.forEach(function(e,o){if(e.textContent!=t.clockValuesAsString[o]){e.textContent=t.clockValuesAsString[o],e.parentElement.classList.add("flipped");var s=setInterval((function(){e.parentElement.classList.remove("flipped"),clearInterval(s)}).bind(t),500)}})}var s=this,i=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];this.clockStrings.d=pad(this.clockValues.d,2),this.clockStrings.h=pad(this.clockValues.h,2),this.clockStrings.m=pad(this.clockValues.m,2),this.clockStrings.s=pad(this.clockValues.s,2),this.clockValuesAsString=(this.clockStrings.d+this.clockStrings.h+this.clockStrings.m+this.clockStrings.s).split(""),this.rotorLeafFront.forEach(function(t,e){t.textContent=s.prevClockValuesAsString[e]}),this.rotorBottom.forEach(function(t,e){t.textContent=s.prevClockValuesAsString[e]}),i?(e.call(this),o.call(this)):(setTimeout(e.bind(this),500),setTimeout(o.bind(this),500)),this.prevClockValuesAsString=this.clockValuesAsString}}]),e}();function pad(t,e){return(t=t.toString()).length<e?pad("0"+t,e):t}function appendChildren(t,e){e.forEach(function(e){t.appendChild(e)})}