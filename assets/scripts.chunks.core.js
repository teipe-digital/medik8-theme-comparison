(()=>{"use strict";var e={d:(t,i)=>{for(var r in i)e.o(i,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:i[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function DomReadyPromise_DomReadyPromise(){return new Promise((function(e,t){"loading"!==document.readyState?e():addEventListener("DOMContentLoaded",(()=>{e()}))}))}function parseHTML_parseHTML(e){const t=document.createElement("template");return t.innerHTML=e,t.content}e.r(t),e.d(t,{DomReadyPromise:()=>DomReadyPromise_DomReadyPromise,GlobalCart:()=>GlobalCart_GlobalCart,GlobalSectionLoader:()=>GlobalSectionLoader,ObserverLite:()=>ObserverLite_ObserverLite,SitewidePriceHandler:()=>SitewidePriceHandler,StoreFrontApi:()=>StoreFrontApi,_babelPolyfill:()=>i,clearCookie:()=>clearCookie,debounce:()=>debounce,parseHTML:()=>parseHTML_parseHTML});class ObserverLite_ObserverLite{constructor(e){if(e=e||{},this.id=Math.floor(999999999999*Math.random()),this.settings=e,e.key){if(window.GlobalObersverLiteInstances=window.GlobalObersverLiteInstances||{},window.GlobalObersverLiteInstances[e.key])return window.GlobalObersverLiteInstances[e.key];window.GlobalObersverLiteInstances[e.key]=this}}once(){return new Promise(((e,t)=>{this.onceDone&&e(this.onceDone);const i=this.subscribe((t=>{t=t||!0,this.onceDone=t,e(t),this.unsubscribe(i)}))}))}setOnce(e){e=e||!0,this.onceDone=e}next(...e){this.onceDone||this.setOnce(...e),this.subject&&this.subject.length&&this.subject.forEach((({callback:t})=>{t(...e)}))}subscribe(e){return this.subject=this.subject||[],e={callback:e,id:Math.floor(1e14+9e14*Math.random())},this.subject.push(e),e}unsubscribe(e){this.subject=this.subject.filter((({id:t})=>t!==e.id))}unsubscribeAll(e){this.subject?.forEach((e=>this.unsubscribe(e))),e&&(this.onceDone=!1)}}class ShopifyUtils{constructor(e){this.money_format=e.money_format||"Â£{{amount}}"}handleize(e){return e.toLowerCase().replace(/[^\w\u00C0-\u024f]+/g,"-").replace(/^-+|-+$/g,"")}parseImgUrl(e,t){const i=e.includes(".png")?"png":"jpg";return`${e.split("png"==i?".png":".jpg")[0]}_${t}x.${i}`}formatMoney(e,t){"string"==typeof e&&(e=e.replace(".",""));var i="",r=/\{\{\s*(\w+)\s*\}\}/,s=t||this.money_format;function defaultOption(e,t){return void 0===e?t:e}function formatWithDelimiters(e,t,i,r){if(t=defaultOption(t,2),i=defaultOption(i,","),r=defaultOption(r,"."),isNaN(e)||null==e)return 0;var s=(e=(e/100).toFixed(t)).split(".");return s[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+i)+(s[1]?r+s[1]:"")}switch(s.match(r)[1]){case"amount":i=formatWithDelimiters(e,2);break;case"amount_no_decimals":i=formatWithDelimiters(e,0);break;case"amount_optional_decimals":i=formatWithDelimiters(e,2),i=Number(i)%1==0?Number(i).toFixed(0):i;break;case"amount_with_comma_separator":i=formatWithDelimiters(e,2,".",",");break;case"amount_with_period_separator":i=formatWithDelimiters(e,2,",",".");break;case"amount_no_decimals_with_comma_separator":i=formatWithDelimiters(e,0,".",",")}return s.replace(r,i)}}class GlobalCart_GlobalCart{constructor(e){const t=new ObserverLite_ObserverLite({key:"GlobalCart$"});if(!e)return new Promise((async(e,i)=>{e(await t.once())}));this.ObserverLite=new ObserverLite_ObserverLite,this.requestQueues$=new ObserverLite_ObserverLite({key:"GlobalCart.requestQueues$"}),this.ShopifyUtils=new ShopifyUtils({money_format:e.money_format||!1}),this.currency_symbol=e.currency_symbol,this.market=e.market.replace(/\/?$/,"/"),this.updateCartData(e.cart),this.section_ids=["global__cart_json"],this.addFetchMnkPatch(),t.next(this),document.addEventListener("octane.quiz.addToCart",(e=>{this.forceUpdateCart()})),document.addEventListener("loyalty.redemption",(e=>{this.forceUpdateCart()})),document.addEventListener("update-drawer-cart",(e=>{if(this.forceUpdateCart(),e.detail.openDrawer){const e=document.querySelector(".js-cart-toggle.jsonly");null!=e&&e.click()}}))}forceUpdateCart(){const e={updates:{},sections:this.section_ids.join(",")};fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),globalCart:!0}).then((e=>{if(!e.ok)throw new Error("Failed to update cart data");return e.json()})).then((e=>{if(!e.sections)throw new Error("No sections in cart response");this.last_item=e,this.cartResponseHandler(e)})).catch((e=>{console.error("Error updating cart:",e)}))}subscribe(e){return this.ObserverLite.subscribe(e)}next(e){this.ObserverLite.next(e)}serialize(e){const t={};function setValue(e,t,i){const r=t.pop();let s=e;for(const e of t)s[e]||(s[e]={}),s=s[e];s[r]=i}const i=new FormData(e);for(let[e,r]of i.entries()){setValue(t,e.split("[").map((e=>e.replace("]",""))),r)}return t}updateCartData(e){e.selling_plan_groups=!!e.selling_plan_groups&&e.selling_plan_groups.filter((({selling_plan_group:e})=>e)).map((e=>{const t=e.selling_plan_group?.selling_plans?.map((({price_adjustments:e})=>e.filter((({value_type:e})=>"percentage"==e)).map((({value:e})=>e)))).flat(1).sort(((e,t)=>e-t))||!1;return e.selling_plan_group.discount_percentage=!!t&&t[0],e})),this.cart=e.cart,this.cart.items.forEach(((t,i)=>{if(t.line=i+1,!t.selling_plan_group){const i=e.selling_plan_groups.find((({variant_id:e})=>e==t.variant_id));t.selling_plan_group=i?.selling_plan_group||!1}}));const t=new Map(e.badges?.map((e=>[e.variant_id,e.badge])));this.cart.items.forEach((e=>{e.badge=t.get(e.variant_id)||null}));const i=this.cart.items.filter((({quantity:e})=>!e));this.cart.items=this.cart.items.filter((({quantity:e})=>e)),this.cart.itemsWithZeroBugCatch=!!i.length&&i}cartResponseHandler(e,t){if(e.sections&&e.sections.global__cart_json){this.sections=e.sections;try{let e=parseHTML(this.sections.global__cart_json).querySelector("template").innerHTML;this.updateCartData(JSON.parse(e))}catch(e){const t=new Error("error parsing cart data");throw t.data=e,t}e.queue||this.next({eventType:"update",discrete:t,data:{itemsWithZeroBugCatch:this.cart.itemsWithZeroBugCatch}})}}addToCart(e,t){return new Promise(((i,r)=>{e||r({description:"Sorry, there was a problem with that request"});e.items.filter((({id:e})=>this.getLineItemsByVariantId(e).map((({quantity:e})=>e)).reduce(((e,t)=>e+t),0)>=6)).length&&r({type:"max_six"}),e.sections=this.section_ids,fetch(`${this.market}cart/add.js`,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"},globalCart:!0}).then((async e=>{if(200==e.status)return e.json();{const t=await e.json(),i=new Error(t.description);throw i.data=t,i}})).then((e=>{if(!e)throw new Error("no data in cart response");this.last_item=e,this.cartResponseHandler(e,t),i()})).catch((e=>{r(e)}))}))}updateQty(e,t,i,r){return new Promise(((s,n)=>{i=i||[{key:e.key,quantity:t}],e?.properties?._bundle_id&&(i=i.concat(this.cart.items.filter((({properties:t})=>t?._bundle_id==e.properties._bundle_id)).map((({key:e})=>({key:e,quantity:0})))));const a=i.reduce(((e,t)=>({...e,[t.key]:t.quantity})),{});fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({updates:a,sections:this.section_ids}),globalCart:!0}).then((async e=>{if(200==e.status)return e.json();{const t=await e.json(),i=new Error(t.description);throw i.data=t,i}})).then((e=>{if(!e)throw new Error("no data in cart response");window.lion&&window.lion.setCartState(e),this.cartResponseHandler(e,r),s()})).catch((e=>{n(e),this.next({eventType:"error",error:e,discrete:r})}))}))}updateLine(e,t){return new Promise(((i,r)=>{if(e.key){const t=this.getLineItemsByKey(e.key);if(!t)return void r({err:"no line item matching key"});e.line=t.line,delete e.key}e.sections=this.section_ids,fetch("/cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),globalCart:!0}).then((async e=>{if(200==e.status)return e.json();{const t=await e.json(),i=new Error(t.description);throw i.data=t,i}})).then((e=>{if(!e)throw new Error("no data in cart response");this.cartResponseHandler(e,t),i()})).catch((e=>{r(e),this.next({eventType:"error",error:e,discrete:t})}))}))}removeLineItemsByKey(e,t){const i=e.reduce(((e,t)=>(e[t]=0,e)),{});return new Promise(((e,r)=>{fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({updates:i,sections:this.section_ids}),globalCart:!0}).then((async e=>{if(200==e.status)return e.json();{const t=await e.json(),i=new Error(t.description);throw i.data=t,i}})).then((i=>{if(!i)throw new Error("no data in cart response");this.cartResponseHandler(i,t),e()})).catch((e=>{r(e),this.next({eventType:"error",error:e,discrete:t})}))}))}getLineItemsByVariantId(e){return e=parseInt(e),this.cart&&this.cart.items?this.cart.items.filter((({variant_id:t})=>t==e)):[]}getLineItemsByKey(e){return!(!this.cart||!this.cart.items)&&this.cart.items.find((({key:t})=>t==e))}getLineItemsByProperty(e,t){return this.cart&&this.cart.items?this.cart.items.filter((i=>{let r=i.properties?.[e];return r=!!(null==t&&r||r&&r==t),r})):[]}getAllDiscountCodes(){return new Promise((async(e,t)=>{const i=await this.cart;let r;i?.items.length?(r=[...new Set(i.items.filter((({discounts:e})=>e?.length)).map((({discounts:e})=>e.map((({title:e})=>e)))).flat())],r=!!r.length&&r[0],localStorage.setItem("discountCode",r),e(r)):(r=Object.fromEntries(new URLSearchParams(document.cookie.replace(/; /g,"&")))?.discount_code||!1,r?localStorage.setItem("discountCode",r):r=localStorage.getItem("discountCode"),e(r))}))}async get_CartFreeDiscountV2Gifts(){const{items:e}=await this.cart;return e?.filter((({properties:e})=>e?._FreeGiftTieredDiscountId))||!1}async get_CartTotalMinusFreeGifts(e){const t=await this.cart;let i=e?t.total_price:t.original_total_price;const r=await this.get_CartFreeDiscountV2Gifts();return i-=r?.map((({original_price:e})=>e)).reduce(((e,t)=>e+t),0)||0,i}requestQueueHandler(e){const t=Object.values(e).reduce(((e,t)=>e+t),0);this.requestQueues$.next(t)}addFetchMnkPatch(){const e=window.fetch,t=[`${this.market}cart/add.js`,"/cart/update.js","/cart/change.js"],i={};let r=Promise.resolve();window.fetch=async(...s)=>{if(s[0]instanceof Request)return e(s[0]);const[n,a]=s;let o=!1,c=!1;try{"string"==typeof n&&(c=t.some((e=>{try{return n.includes(e)}catch(e){return!1}})))}catch(t){return e(...s)}if(c){if(a?.globalCart)i[n]=i[n]||0,i[n]=i[n]+1;else try{const e=a.headers?.["Content-Type"];if("application/json"===e){const e=JSON.parse(a.body);e.sections=[...e.sections?e.sections:[],...this.section_ids],a.body=JSON.stringify(e)}else if(e?.startsWith("application/x-www-form-urlencoded")){const e=new URLSearchParams(a.body);e.set("sections",this.section_ids.join(",")),a.body=e.toString()}else console.warn("Unhandled Content-Type:",a.headers["Content-Type"])}catch(e){console.error("Error processing settings.body:",e),o=!0}this.requestQueueHandler(i);return new Promise(((t,c)=>{r=r.finally((()=>e(...s).then((async e=>{const r=e.clone();if(!o){i[n]&&(i[n]=i[n]-1);let s=i[n],o=await e.json();o.queue=s;const c=new Response(JSON.stringify(o),{status:e.status,statusText:e.statusText,headers:e.headers});t(c),this.requestQueueHandler(i),r.json().then((e=>{e.queue=s,a?.globalCart||this.cartResponseHandler(e)}))}})).catch((e=>{c(e)}))))}))}return e(...s)}}}function clearCookie(e,t,i){e.preventDefault(),t.forEach((e=>{document.cookie=`${e}=; Path=/; Domain=medik8.com; Expires=Thu, 01 Jan 1970 00:00:01 GMT;`,i&&location.reload()}))}function debounce(e,t){let i;return function(...r){clearTimeout(i),i=setTimeout((()=>{e(...r)}),t)}}class SitewidePriceHandler{constructor(e){if(!window.progressBarTieredDiscountsData?.metafields)return;const t=`${window.cartCurrencySymbol}{{amount_optional_decimals}}`;this.ShopifyUtils=new ShopifyUtils({money_format:t}),this.customerTags=e||[],this.sitewideTierReady=this.setSitewideTier()}async setSitewideTier(){this.GlobalCart=await new GlobalCart;const e=await this.GlobalCart.getAllDiscountCodes(),t=this.#e(window.progressBarTieredDiscountsData.metafields,e),i=t?this.#t(t,this.GlobalCart.cart.original_total_price):null;this.sitewideTier=i&&Number(i.amount)>0?i:null,this.sitewideTier&&(this.sitewideTier.discountSubs=t.discountSubs),this.discount=this.sitewideTier?this.sitewideTier.amount/100:null,this.discountMethod=this.sitewideTier?t.globalDiscountApplication.method:null;const r=this.sitewideTier?t.globalDiscountApplication.products:null;this.allVariants=r?Object.values(r).flat().map((e=>e.split("/").pop())):[]}async updatePriceV2(e,t=document,i=!1){if(await this.sitewideTierReady,!this.sitewideTier||!this.#i(e))return;t.querySelectorAll(`span.price-v2__${e}`).forEach((e=>{if(!i||!e.hasAttribute("price-v2-init")){e.setAttribute("price-v2-init","");const t=100*Number(e.textContent.slice(1));if(!e.previousElementSibling){const i=this.#r(e,t);e.insertAdjacentElement("beforebegin",i)}e.textContent=this.ShopifyUtils.formatMoney(t-t*this.discount)}}))}async updateRegimePriceV2(e,t){if(await this.sitewideTierReady,!this.sitewideTier||!this.#i(e))return;const i=t.closest("form").querySelector("select"),r=Number(i.options[i.selectedIndex].getAttribute("price-act")),s=t.previousElementSibling;if(!s?.hasAttribute("compare-at")){s?.remove();const e=this.#r(t,r);t.insertAdjacentElement("beforebegin",e)}t.textContent=this.ShopifyUtils.formatMoney(r-r*this.discount)}async updateGlobalProductPriceV2(e,t){if(await this.sitewideTierReady,!this.sitewideTier||!this.#i(e))return t;const i=(new DOMParser).parseFromString(t,"text/html"),r=i.querySelector(`span.price-v2__${e}`),s=100*Number(r.textContent.replace(",",".").slice(1));if(!r.previousElementSibling){const e=this.#r(r,s);e.classList.add("cell-r--d3"),r.insertAdjacentElement("beforebegin",e)}return r.classList.add("f-w600"),r.textContent=this.ShopifyUtils.formatMoney(s-s*this.discount),i.body.innerHTML}async updateSelectOptionPrice(e,t){if(await this.sitewideTierReady,!this.sitewideTier||!this.#i(e))return;const i=parseHTML(t.getAttribute("data-price")),r=100*Number(i.querySelector("span").textContent.slice(1));if(null===i.querySelector("s")){const e=this.#r(i.querySelector("span"),r);i.prepend(e)}i.querySelector("span").textContent=this.ShopifyUtils.formatMoney(r-r*this.discount);let s="";for(const e of i.childNodes)s+=e.outerHTML||e.nodeValue;t.setAttribute("data-price",s)}async updateSelectOptionLabel(e,t){if(await this.sitewideTierReady,!this.sitewideTier||!this.#i(e)||""===this.sitewideTier.label)return;const i=t.getAttribute("data-label"),r=(new DOMParser).parseFromString(i,"text/html");r.body.querySelector(".label-wrapper").innerHTML=`<span class='badge-v2 badge-v2__product-card' aria-label='${this.sitewideTier.label}'>${this.sitewideTier.label}</span>`,t.setAttribute("data-label",r.body.innerHTML)}async updateQuickView(e){if(await this.sitewideTierReady,!this.sitewideTier)return e;const t=(new DOMParser).parseFromString(e,"text/html").querySelector("global-product-quick-view");let i=t.querySelector("input[data-variant-id]")?.getAttribute("data-variant-id");i||(i=t.querySelector(".wayfx-product__grid[data-variant-id]")?.getAttribute("data-variant-id")),await this.updatePriceV2(i,t),await this.updateLabelV2(i,t);const r=t.querySelectorAll("select option");for(const e of r)await Promise.all([this.updateSelectOptionPrice(e.value,e),this.updateSelectOptionLabel(e.value,e)]);return t.outerHTML||""}async updateSubscriptionPricing(e,t=document){if(await this.sitewideTierReady,!this.sitewideTier||!this.#i(e))return;(this.sitewideTier.discountSubs?["onetime","subsave"]:["onetime"]).forEach((e=>{const i=t.querySelectorAll(`.rc_widget__price--${e}`);setTimeout((()=>{i.forEach((e=>{const t=100*Number(e.textContent.slice(1));e.textContent=this.ShopifyUtils.formatMoney(t-t*this.discount,`${window.cartCurrencySymbol}{{ amount_with_period_separator }}`);const i=e.previousElementSibling;i&&!i.textContent.length&&(i.textContent=this.ShopifyUtils.formatMoney(t,`${window.cartCurrencySymbol}{{ amount_with_period_separator }}`))}))}),0)}))}async updateRegimeSubscriptionPricing(e,t=document){if(await this.sitewideTierReady,!this.sitewideTier||!this.#i(e))return;(this.sitewideTier.discountSubs?["onetime","subsave"]:["onetime"]).forEach((e=>{const i=t.querySelectorAll(`.rc_widget__price--${e}`);setTimeout((()=>{i.forEach((e=>{const t=100*Number(e.textContent.slice(1));e.textContent=this.ShopifyUtils.formatMoney(t-t*this.discount,`${window.cartCurrencySymbol}{{ amount_with_period_separator }}`);const i=e.closest("form").querySelector(".regime-product-card__submit s.price-v2-pdp").getAttribute("compare-at"),r=e.previousElementSibling;r&&(r.textContent=this.ShopifyUtils.formatMoney(i??t,`${window.cartCurrencySymbol}{{ amount_with_period_separator }}`))}))}),0)}))}async updateLabelV2(e,t=document){if(await this.sitewideTierReady,!this.sitewideTier||!this.#i(e)||""===this.sitewideTier.label)return;t.querySelectorAll(`.label-wrapper__${e}`).forEach((e=>{const t=e.getAttribute("data-type");e.innerHTML=this.#s(t,this.sitewideTier.label)}))}async updateGlobalProductThumbnailLabelV2(e,t){return await this.sitewideTierReady,this.sitewideTier&&this.#i(e)&&""!==this.sitewideTier.label?this.#s("product-card",this.sitewideTier.label):t}async variantHasLabel(e){return await this.sitewideTierReady,!(!this.sitewideTier||!this.#i(e)||""===this.sitewideTier.label)}#i(e){return{all:()=>!0,allow_specific:()=>this.#n(e,this.allVariants,!0),block_specific:()=>this.#n(e,this.allVariants,!1)}[this.discountMethod]()}#e(e,t){const i=new Date;let r=Object.values(e).filter((e=>{const t=new Date(e.startsAt),r=e.endsAt?new Date(e.endsAt):null,s=e.customerTags;return i>t&&(!r||i<r)&&(0===s.length||this.#a(s,this.customerTags))}));r=r.filter((e=>!e.discountCode||e.discountCode===t));return r.reduce(((e,t)=>Math.max(...t.tiers.map((e=>e.amount)))>(e?Math.max(...e.tiers.map((e=>e.amount))):-1/0)?t:e),null)}#t(e,t){const i=e.tiers.sort(((e,t)=>t.threshold-e.threshold));let r;for(const e of i){if(t>=100*(e.calcDiscountTotal?e.thresholdWithMultiplier:e.threshold)){r=e;break}}return r}#n(e,t,i){const r=t.some((t=>t===e));return i?r:!r}#a(e,t){const i=t.map((e=>e.toLowerCase()));return e.some((e=>i.includes(e.toLowerCase())))}#r(e,t){const i=[...e.classList].map((e=>e.replace("actual","pre"))).slice(0,-1),r=document.createElement("s");return r.classList.add(...i),r.setAttribute("aria-hidden","true"),r.textContent=this.ShopifyUtils.formatMoney(t),r}#s(e,t){return{pdp:()=>`<span class='badge-v2 badge-v2__pdp' aria-label='${t}'>${t}</span>`,"product-card":()=>`<span class='badge-v2 badge-v2__product-card block-z3' aria-label='${t}'>${t}</span>`}[e]()}}class GlobalSectionLoader extends HTMLElement{constructor(){super()}connectedCallback(){DomReadyPromise().then((async()=>{let e=this.querySelector(":scope > template[data-settings]"),t=this.querySelector(":scope > template[data-content]");if(t&&(this.content=t.innerHTML,t.remove(),t=null),e){try{this.settings=JSON.parse(e.innerHTML)}catch(e){console.log(e)}e.remove(),e=null}this.setupObserver()})).catch((e=>{console.log(e)}))}setupObserver(){const e=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&(this.init(),e.disconnect())}))}),{rootMargin:"100% 0px"});e.observe(this)}async init(){this.settings?.components?.length&&(this.loader=new DynamicImporter(this.settings.components.map((e=>({type:"js",url:e})))),await this.loader.load()),this.content&&(this.innerHTML=this.content)}}customElements.define("global-section-loader",GlobalSectionLoader);class StoreFrontApi{constructor(e){const t=new ObserverLite({key:"StoreFrontApi$"});if(!e)return new Promise((async(e,i)=>{e(await t.once())}));this.ObserverLite=new ObserverLite,this.endpoint=`${e.storeUrl}/api/${e.version}/graphql.json`,this.accessToken=e.accessToken,t.next(this)}subscribe(e){return this.ObserverLite.subscribe(e)}next(e){this.ObserverLite.next(e)}authFetch(e){const t={method:e?.method||"POST",headers:{"Content-Type":"application/graphql","X-Shopify-Storefront-Access-Token":this.accessToken}};return e?.body&&(t.body=e.body),new Promise(((e,i)=>{fetch(this.endpoint,t).then((e=>e.json())).then((t=>{e(t)})).catch((e=>{i(e)}))}))}}const i=!0;var r=self;for(var s in t)r[s]=t[s];t.__esModule&&Object.defineProperty(r,"__esModule",{value:!0})})();