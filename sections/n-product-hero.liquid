<!-- sections/n-product-hero.liquid -->

{%- assign current_variant = product.selected_or_first_available_variant -%}
{%- assign product_subtitle = product.metafields.sf_product_hero.sub_heading -%}
{%- assign product_description = product.metafields.sf_product_hero.description -%}
{%- assign product_size = product.metafields.sf_product_hero.size -%}
{%- assign highlight_title_1 = product.metafields.sf_product_hero.highlight_1_heading -%}
{%- assign highlight_text_1 = product.metafields.sf_product_hero.highlight_1_description -%}
{%- assign highlight_title_2 = product.metafields.sf_product_hero.highlight_2_heading -%}
{%- assign highlight_text_2 = product.metafields.sf_product_hero.highlight_2_description -%}
{%- assign highlight_title_3 = product.metafields.sf_product_hero.highlight_3_heading -%}
{%- assign highlight_text_3 = product.metafields.sf_product_hero.highlight_3_description -%}


{%- assign site_wide_enabled = settings.site_wide__enabled -%}
{%- assign site_wide_percentage = settings.site_wide__percentage | divided_by: 100.0 -%}
{%- assign site_wide_label = settings.site_wide__label -%}
{%- assign site_wide_label_enabled = settings.site_wide__label_enabled -%}
{%  assign vip_pricing = settings.vip-pricing %}
{%- if settings.discounts__vip_code == blank -%}
  {%- assign site_wide_crossed_out_pricing_enabled = settings.site_wide__crossed_out_pricing_enabled -%}
{%- endif -%}
{%- assign site_wide_collection = settings.site_wide__collection -%}

{%- if site_wide_enabled -%}
  {% for collection in product.collections %}
    {% if collection.handle == site_wide_collection %}
      {% assign site_wide_product = true %}
      {%- assign on_sale = true -%}
    {% endif %}
  {% endfor %}
{% endif %}

{{ "n-product-key-ingredients.css" | asset_url | stylesheet_tag }}

{%- assign full_ingredient_disclaimer = 'products.hero.ingredients_disclaimer' | t -%}

{%- if template == 'product.alternate' -%}
    {%- assign full_ingredient_list = product.metafields.sf_product_layout_b.full_ingredients -%}
{%- else -%}
    {%- assign full_ingredient_list = product.metafields.sf_product_layout_a.full_ingredients -%}
{%- endif -%}

{%- assign productIsGiftCard = false -%}
{%- if product.gift_card? -%}
    {%- assign productIsGiftCard = true -%}
{%- endif -%}

{%- assign sold_out = true -%}
{%- if productIsGiftCard or product.available -%}
  {%- assign sold_out = false -%}
{%- endif -%}

{%- assign low_stock = false -%}
{%- if current_variant.inventory_quantity > 0 and current_variant.inventory_quantity < 20 -%}
    {%- assign low_stock = true -%}
{%- endif -%}


<div class="wayfx-wrapper">
  <div class="wayfx-product__photos-wrapper">
    <div class="wayfx-product__photos-block">
        <div class="wayfx-product__featured-photo" id="ProductPhoto">
          {% for media in product.media %}
            <div class="wayfx-product__thumbnail">
              {% case media.media_type %}
                {% when 'image' %}
                  <div class="product-single__media" data-media-id="{{ media.id }}">
                    {{ media | image_url: width: 2048, height: 2048 | image_tag }}
                  </div>
                {% when 'external_video' %}
                  <div class="product-single__media" data-media-id="{{ media.id }}">
                    {{ media | video_tag: loop: true, autoplay: false, controls: true, image_size: "1024x" }}
                  </div>
                {% when 'video' %}
                  <div class="product-single__media" data-media-id="{{ media.id }}">
                    {{ media | video_tag: loop: true, autoplay: false, controls: true, image_size: "1024x" }}
                  </div>
                {% when 'model' %}
                  <div class="product-single__media">
                    {{ media | model_viewer_tag }}
                  </div>
              {% endcase %}
            </div>
          {% endfor %}
        </div>
        {% if product.images.size > 1 %}
        <div class="wayfx-product__thumbnails">
         {% for media in product.media %}
          {% case media.media_type %}
            {% when 'image' %}
              <div class="wayfx-product__thumbnail" data-media-id="{{ media.id }}">
                {{ media | image_url: width: 70, height: 70 | image_tag }}
              </div>
            {% when 'external_video' %}
              <div class="wayfx-product__thumbnail" data-media-id="{{ media.id }}">
                {% render "icon-play" %}
              </div>
            {% when 'video' %}
              <div class="wayfx-product__thumbnail" data-media-id="{{ media.id }}">
                {% render "icon-play" %}
              </div>
            {% when 'model' %}
              <div class="wayfx-product__thumbnail">
                {{ media | model_viewer_tag }}
              </div>
          {% endcase %}
        {% endfor %}
        </div>
        {% endif %}
    </div>
  </div>

  <div class="wayfx-product__details">

    <div>

      <div class="wayfx-product__low-stock-wrap"{% unless low_stock %} style="display: none"{% endunless %}><div class="wayfx-product__low-stock">Low Stock</div></div>
      <h1 class="wayfx-product__title">{{ product.title }}</h1>

      {%- if product_subtitle -%}
          <h2 class="wayfx-product__subtitle">{{ product_subtitle }}</h2>
      {%- endif -%}

      <div class="wayfx-product__actions">
        {%- if settings.yotpo_stars_instance_id != blank -%}
          <div class="yotpo-widget-instance" data-yotpo-instance-id="{{ settings.yotpo_stars_instance_id }}" data-yotpo-product-id="{{product.id}}" data-yotpo-cart-product-id="" data-yotpo-section-id="{{template.name}}"></div>
        {%- endif -%}
        <div class="wayfx-product__wishlist">
          {% render 'product-wishlist' with product %}
        </div>
      </div>


      {% if product_size %}

      <div class="wayfx-product__size" style="margin-top: 15px;">
        {{ product_size }}
      </div>
      {% endif %}

      {%- if current_variant.title contains "travel" or current_variant.title contains "Travel" -%}
        {%- assign site_wide_product = false -%}
      {%- endif -%}

      {%- if site_wide_product == true and site_wide_enabled == true -%}
        {%- if site_wide_crossed_out_pricing_enabled -%}
            {%- assign discount_off = current_variant.price | times: site_wide_percentage -%}
            {%- assign discount_price = current_variant.price | minus: discount_off -%}
        {%- endif -%}
      {% elsif current_variant.compare_at_price >= current_variant.price  %}
        {%- assign discount_price = current_variant.compare_at_price -%}
      {%- endif -%}
   
      <div class="medk8-product--price-box">

        {% if current_variant.compare_at_price >= current_variant.price  %}
          <span id="ProductPrice" aria-label="original price" class="slashed-price">
            {{ discount_price  | money_without_trailing_zeros }}
          </span>
          <span id="DiscountedPrice" class="DiscountedPrice" aria-label="discounted price" style="display:initial;">
            {{ current_variant.price  | money_without_trailing_zeros }}
          </span>
        {% else %}
          <span id="ProductPrice" aria-label="original price" 
            {%- if site_wide_product == true and site_wide_enabled == true and vip_pricing != true -%}class="slashed-price"{%- endif-%}>
            {{ current_variant.price | money_without_trailing_zeros }}
          </span>

          <span id="DiscountedPrice" class="DiscountedPrice" aria-label="discounted price" {%- if site_wide_product == true and site_wide_enabled == true -%}style="display:initial;"{%- endif-%}>
            {%- if site_wide_product == true and site_wide_enabled == true -%}
              {{discount_price | money_without_trailing_zeros }}
            {%- endif-%}
          </span>
        {% endif %}
        


        {% render 'product-loyalty-points' section:section %}
        

      </div>

      {% render 'product-bar' %}

      <form action="/cart/add" method="post" enctype="multipart/form-data" id="AddToCartForm" class="form-vertical" data-productid="{{product.id}}">

          {%- unless sold_out -%}
            <div class="medk8-product--quantity-box">
                 
                
                <global-qty-selector class="js-product-main-qty">
                  <input type="number" 
                         name="quantity" 
                         value="1" 
                         min="1"
                         max="6" />
                </global-qty-selector>

                <div class="wayfx-product__returns">
                    <a data-fancybox data-src="#easy-returns" data-touch="false">{{section.settings.shipping_popup}}</a>
                </div>

            </div>
          {% endunless %}


          {% if product.variants.size == 1 and product.variants.first.title contains 'Default' %}
              <input type="hidden" name="id" id="productSelect" value="{{ product.selected_or_first_available_variant.id }}" />
          {% else %}
            <select name="id" id="productSelect" class="product-single__variants" data-productid="{{ product.id }}">
              {%- for variant in product.variants -%}
                {%- unless variant.title contains "travel" or variant.title contains "Travel" -%}
                  {%- assign site_wide_product = true -%}
                {%- endunless -%}
                {%- if site_wide_product == true and site_wide_enabled == true -%}
                  {%- if site_wide_crossed_out_pricing_enabled -%}
                      {%- assign discount_off = variant.price | times: site_wide_percentage -%}
                      {%- assign discount_price = variant.price | minus: discount_off -%}
                  {%- endif -%}
                {%- endif -%}

                {%- assign variant_sold_out = false -%}
                {%- assign low_stock = false -%}
                {%- if variant.inventory_quantity > 0 and variant.inventory_quantity < 20 -%}
                  {%- assign low_stock = true -%}
                {%- endif -%}
                {%- if productIsGiftCard == false %}
                  {%- unless variant.available -%}
                    {%- assign variant_sold_out = true -%}
                  {% endunless %}
                {%- endif -%}
                {%- assign variant_size = variant.metafields.sf_settings.size -%}
                  <option
                          {% if variant_sold_out %}data-disabled="true"{% endif %}
                          {% if variant == product.selected_or_first_available_variant %} selected="selected"{% endif %}
                          {% if low_stock %} data-low-stock="true"{% else %} data-low-stock="false"{% endif %}
                          data-image-id="{{ variant.image.id }}"
                          data-sku="{{ variant.sku }}"
                          value="{{ variant.id }}"
                          {% if variant.compare_at_price >= variant.price %}
                            data-price="{{ variant.compare_at_price | money_without_trailing_zeros }}"
                          {% else %}
                            data-price="{{ variant.price | money_without_trailing_zeros }}"
                          {% endif %}
                          {%- unless variant.title contains "travel" or variant.title contains "Travel" -%}
                            {% if variant.compare_at_price >= variant.price %}
                              data-discounted-price="{{variant.price | money_without_trailing_zeros }}"
                            {% else %}
                              data-discounted-price="{{discount_price | money_without_trailing_zeros }}"
                            {% endif %}
                          {%- endunless -%}
                          data-variant-id="{{ variant.id }}"
                          data-variant-title="{{ variant.title }}"
                          {% if variant.inventory_management  == 'Shopify' %}
                          data-variant-inventory-qty="{{ variant.inventory_quantity }}"
                          data-variant-inventory-management="{{variant.inventory_management }}"
                          {% endif %}>
                    		{{ variant.title }}
                    		{% if variant_size != 0 and productIsGiftCard != true %} - {{ variant_size }}{% endif %}
                    		{% if variant_sold_out %} - {{ 'products.product.sold_out' | t }}{% endif %}
             	  </option>
              {%- endfor -%}
            </select>
          {% endif%}

          {% assign showAtcOnInit = false %}
          {% if sold_out == false or product.selected_or_first_available_variant.available == true or productIsGiftCard %}
          {% assign showAtcOnInit = true %}
          {% endif %}

          <button type="submit" 
                  name="add" 
                  id="AddToCart" 
                  class="js-product-main-atc btn btn--full btn--large"
                  onClick="GlobalCartMain.addProductFromButton(event)"
                  {% if showAtcOnInit == false %} 
                  style="display:none;" 
                  {% endif %}>
            <span id="AddToCartText">
              {{ 'products.product.add_to_cart' | t }}
            </span>
          </button>
      </form>

      <div id="AddToCartDisabled"
        {% if showAtcOnInit %} 
          style="display:none;" 
        {% endif %}>
        {% if product.tags contains 'Coming Soon' %}
        <span class="mdk8--coming-soon">{{ 'products.product.coming_soon' | t }}</span>
        {%- else -%}
          {% if section.settings.oos__show %}
            {% render 'block-oos-notify' section:section %}
          {% else %}
            <span class="mdk8--sold-out">{{ 'products.product.sold_out' | t }}</span>
          {%- endif -%}
        {%- endif -%}
      </div>

      <div id="easy-returns" style="display: none;">
        <p class="p--md">{{ section.settings.popup_text }}</p>
      </div>

      {% for tag in product.tags %}
        {% if tag == "find-your-crystal" %}
          <p style="font-size:15px; border: dotted #000; padding: 2%; margin-bottom:1em;">{{ 'products.product.quiz_text' | t }}
            <a href="" id="quiz-page" style="font-weight:800; text-decoration:underline; display: inline-block;">{{ 'products.product.quiz_link_text' | t }}</a>
          </p>
        <script>
          $(document).ready(function () {
          
            $('#quiz-page').click(function(e) {
              e.preventDefault();
          
              $.fancybox.open({
                src  : "/pages/find-your-crystal-match?view=blank-quiz",
                type : 'ajax',
                opts : {
                  touch: false,
                  afterLoad : function( instance, current ) {
                  }
                }
              });

            });
          
          });
        </script>
       {% endif %}
      {% endfor %}

      {%- if product_description -%}
          <p class="wayfx-product__description">{{ product_description }}</p>
      {%- endif -%}


      <dl class="wayfx-product__highlights">
          {%- if highlight_title_1 -%}
            <dt>{{ highlight_title_1 }}</dt>
            <dd>{{ highlight_text_1 }}</dd>
          {%- endif -%}
          {%- if highlight_title_2 -%}
              <dt>{{ highlight_title_2 }}</dt>
              <dd>{{ highlight_text_2 }}</dd>
          {%- endif -%}
          {%- if highlight_title_3 -%}
              <dt>{{ highlight_title_3 }}</dt>
              <dd>{{ highlight_text_3 }}</dd>
          {%- endif -%}
      </dl>
      {% if template == 'product.alternate' %}




<!-- ///  --->




          <div class="wayfx-product__accordion">
            {%- assign benefit_title_1 = product.metafields.sf_product_layout_b.key_benefit_1_heading -%}
            {%- assign benefit_paragraph_1 = product.metafields.sf_product_layout_b.key_benefit_1_description -%}
            {%- assign benefit_title_2 = product.metafields.sf_product_layout_b.key_benefit_2_heading -%}
            {%- assign benefit_paragraph_2 = product.metafields.sf_product_layout_b.key_benefit_2_description -%}
            {%- assign benefit_title_3 = product.metafields.sf_product_layout_b.key_benefit_3_heading -%}
            {%- assign benefit_paragraph_3 = product.metafields.sf_product_layout_b.key_benefit_3_description -%}
            {%- assign benefit_title_4 = product.metafields.sf_product_layout_b.key_benefit_4_heading -%}
            {%- assign benefit_paragraph_4 = product.metafields.sf_product_layout_b.key_benefit_4_description -%}
            {%- assign benefit_title_5 = product.metafields.sf_product_layout_b.key_benefit_5_heading -%}
            {%- assign benefit_paragraph_5 = product.metafields.sf_product_layout_b.key_benefit_5_description -%}

            {%- assign how_it_works_paragraph = product.metafields.sf_product_layout_b.how_it_works_main_paragraph -%}
            {%- assign how_it_works_item_1 = product.metafields.sf_product_layout_b.how_it_works_list_item_1 -%}
            {%- assign how_it_works_item_2 = product.metafields.sf_product_layout_b.how_it_works_list_item_2 -%}
            {%- assign how_it_works_item_3 = product.metafields.sf_product_layout_b.how_it_works_list_item_3 -%}
            {%- assign how_it_works_item_4 = product.metafields.sf_product_layout_b.how_it_works_list_item_4 -%}
            {%- assign how_it_works_item_5 = product.metafields.sf_product_layout_b.how_it_works_list_item_5 -%}

            {%- assign how_to_use_paragraph = product.metafields.sf_product_layout_b.how_to_use_main_description -%}
            {%- assign how_to_use_item_1 = product.metafields.sf_product_layout_b.how_to_use_list_item_1 -%}
            {%- assign how_to_use_item_2 = product.metafields.sf_product_layout_b.how_to_use_list_item_2 -%}
            {%- assign how_to_use_item_3 = product.metafields.sf_product_layout_b.how_to_use_list_item_3 -%}
            {%- assign how_to_use_item_4 = product.metafields.sf_product_layout_b.how_to_use_list_item_4 -%}
            {%- assign how_to_use_item_5 = product.metafields.sf_product_layout_b.how_to_use_list_item_5 -%}

            {%- assign ingredient_title_1 = product.metafields.sf_product_layout_b.ingredient_1_title -%}
            {%- assign ingredient_description_1 = product.metafields.sf_product_layout_b.ingredient_1_description -%}

            {%- assign ingredient_title_2 = product.metafields.sf_product_layout_b.ingredient_2_title -%}
            {%- assign ingredient_description_2 = product.metafields.sf_product_layout_b.ingredient_2_description -%}

            {%- assign ingredient_title_3 = product.metafields.sf_product_layout_b.ingredient_3_title -%}
            {%- assign ingredient_description_3 = product.metafields.sf_product_layout_b.ingredient_3_description -%}

            {%- assign ingredient_title_4 = product.metafields.sf_product_layout_b.ingredient_4_title -%}
            {%- assign ingredient_description_4 = product.metafields.sf_product_layout_b.ingredient_4_description -%}

            {%- assign ingredient_title_5 = product.metafields.sf_product_layout_b.ingredent_5_title -%}
            {%- assign ingredient_description_5 = product.metafields.sf_product_layout_b.ingredient_5_description -%}

            {%- assign ingredient_title_6 = product.metafields.sf_product_layout_b.ingredient_6_title -%}
            {%- assign ingredient_description_6 = product.metafields.sf_product_layout_b.ingredient_6_description -%}

            {%- assign ingredient_title_7 = product.metafields.sf_product_layout_b.ingredient_7_title -%}
            {%- assign ingredient_description_7 = product.metafields.sf_product_layout_b.ingredient_7_description -%}

            {%- assign ingredient_title_8 = product.metafields.sf_product_layout_b.ingredient_8_title -%}
            {%- assign ingredient_description_8 = product.metafields.sf_product_layout_b.ingredient_8_description -%}

            {%- assign ingredient_not_added_item_1 = product.metafields.sf_product_layout_b.whats_not_included_item_1 -%}
            {%- assign ingredient_not_added_item_2 = product.metafields.sf_product_layout_b.whats_not_included_item_2 -%}
            {%- assign ingredient_not_added_item_3 = product.metafields.sf_product_layout_b.whats_not_included_item_3 -%}
            {%- assign ingredient_not_added_item_4 = product.metafields.sf_product_layout_b.whats_not_included_item_4 -%}
            {%- assign ingredient_not_added_item_5 = product.metafields.sf_product_layout_b.whats_not_included_item_5 -%}
            {%- assign ingredient_not_added_item_6 = product.metafields.sf_product_layout_b.whats_not_included_item_6 -%}
            {%- assign ingredient_not_added_item_7 = product.metafields.sf_product_layout_b.whats_not_included_item_7 -%}
            {%- assign ingredient_not_added_item_8 = product.metafields.sf_product_layout_b.whats_not_included_item_8 -%}
        <ul>

        {% if settings.shipping_title_1 != blank or settings.shipping_title_2 != blank %}
          <li class="wayfx-product__accordion-item">
            <div class="wayfx-product__accordion-title">{{ 'products.general.delivery_options' | t }}</div>
              <div class="wayfx-product__accordion-content wayfx-product__accordion-content--ingredients" style="display: none;">
              <h5 class="h5--primary">{{settings.shipping_title_1}}</h5>
              <p>{{settings.shipping_desc_1}}</p>
              {% if settings.shipping_title_2 != blank %}
                <h5 class="h5--primary">{{settings.shipping_title_2}}</h5>
                <p>{{settings.shipping_desc_2}}</p>
              {% endif %}
            </div>
          </li>
        {% endif%}



            {%- if benefit_title_1 -%}
                <li class="wayfx-product__accordion-item">
                    <div class="wayfx-product__accordion-title">{{ 'products.hero.key_benefits' | t }}</div>
                    <div class="wayfx-product__accordion-content wayfx-product__accordion-content--benefits" style="display: none;">
                        <ul>
                            {%- if benefit_title_1 -%}
                                <li>
                                    <h5 class="h5--primary">{{ benefit_title_1 }}</h5>
                                    {%- if benefit_paragraph_1 %}{{ benefit_paragraph_1 }}{%- endif -%}
                                </li>
                            {%- endif -%}
                            {%- if benefit_title_2 -%}
                                <li>
                                    <h5 class="h5--primary">{{ benefit_title_2 }}</h5>
                                    {% if benefit_paragraph_2 %}{{ benefit_paragraph_2 }}{%- endif -%}
                                </li>
                            {%- endif -%}
                            {%- if benefit_title_3 -%}
                                <li>
                                    <h5 class="h5--primary">{{ benefit_title_3 }}</h5>
                                    {%- if benefit_paragraph_3 -%}{{ benefit_paragraph_3 }}{%- endif -%}
                                </li>
                            {%- endif %}
                            {%- if benefit_title_4 %}
                                <li>
                                    <h5 class="h5--primary">{{ benefit_title_4 }}</h5>
                                    {% if benefit_paragraph_4 -%}{{ benefit_paragraph_4 }}{%- endif -%}
                                </li>
                            {%- endif %}
                            {%- if benefit_title_5 -%}
                                <li>
                                    <h5 class="h5--primary">{{ benefit_title_5 }}</h5>
                                    {%- if benefit_paragraph_5 -%}{{ benefit_paragraph_5 }}{%- endif -%}
                                </li>
                            {%- endif -%}
                        </ul>
                    </div>
                </li>
            {%- endif -%}
            {%- if how_it_works_item_1 -%}
                <li class="wayfx-product__accordion-item">
                    <div class="wayfx-product__accordion-title">{{ 'products.hero.how_it_works' | t }}</div>
                    <div class="wayfx-product__accordion-content wayfx-product__accordion-content--steps" style="display: none;">
                        {%- if how_it_works_paragraph -%}{{ how_it_works_paragraph }}{% endif %}
                        {%- if how_it_works_item_1 -%}
                            <ol>
                              <li>{{ how_it_works_item_1 }}</li>
                              {%- if how_it_works_item_2 -%}<li>{{ how_it_works_item_2 }}</li>{%- endif -%}
                              {%- if how_it_works_item_3 -%}<li>{{ how_it_works_item_3 }}</li>{%- endif -%}
                              {%- if how_it_works_item_4 -%}<li>{{ how_it_works_item_4 }}</li>{%- endif -%}
                              {%- if how_it_works_item_5 -%}<li>{{ how_it_works_item_5 }}</li>{%- endif -%}
                            </ol>
                        {%- endif -%}
                    </div>
                </li>
            {%- endif -%}
            {%- if how_to_use_item_1 or how_to_use_paragraph -%}
                <li class="wayfx-product__accordion-item">
                    <div class="wayfx-product__accordion-title">{{ 'products.hero.how_to_use' | t }}</div>
                    <div class="wayfx-product__accordion-content wayfx-product__accordion-content--usage" style="display: none;">
                        {%- if how_to_use_paragraph -%}{{ how_to_use_paragraph }}{%- endif -%}
                        {%- if how_to_use_item_1 -%}
                            <ol>
                              <li>{{ how_to_use_item_1 }}</li>
                              {%- if how_to_use_item_2 -%}<li>{{ how_to_use_item_2 }}</li>{%- endif -%}
                              {%- if how_to_use_item_3 -%}<li>{{ how_to_use_item_3 }}</li>{%- endif -%}
                              {%- if how_to_use_item_4 -%}<li>{{ how_to_use_item_4 }}</li>{%- endif -%}
                              {%- if how_to_use_item_5 -%}<li>{{ how_to_use_item_5 }}</li>{%- endif -%}
                            </ol>
                        {%- endif -%}
                    </div>
                </li>
            {%- endif -%}
            {%- if ingredient_title_1 -%}
                <li class="wayfx-product__accordion-item">
                    <div class="wayfx-product__accordion-title">{{ 'products.hero.ingredients' | t }}</div>
                    <div class="wayfx-product__accordion-content wayfx-product__accordion-content--ingredients" style="display: none;">
                        <h5 class="h5--primary">{{ ingredient_title_1 }}</h5>
                        {%- if ingredient_description_1 -%}
                          {{ ingredient_description_1 }}
                        {%- endif -%}

                        {%- if ingredient_title_2 -%}
                            <h5 class="h5--primary">{{ ingredient_title_2 }}</h5>
                            {%- if ingredient_description_2 -%}
                                {{ ingredient_description_2 }}
                            {%- endif -%}
                        {%- endif -%}

                        {%- if ingredient_title_3 -%}
                            <h5 class="h5--primary">{{ ingredient_title_3 }}</h5>
                            {%- if ingredient_description_3 -%}
                                {{ ingredient_description_3 }}
                            {%- endif -%}
                        {%- endif -%}

                        {%- if ingredient_title_4 -%}
                            <h5 class="h5--primary">{{ ingredient_title_4 }}</h5>
                            {%- if ingredient_description_4 -%}
                                {{ ingredient_description_4 }}
                            {%- endif -%}
                        {%- endif -%}

                        {%- if ingredient_title_5 -%}
                            <h5 class="h5--primary">{{ ingredient_title_5 }}</h5>
                            {%- if ingredient_description_5 -%}
                                {{ ingredient_description_5 }}
                            {%- endif -%}
                        {%- endif -%}

                        {%- if ingredient_title_6 -%}
                            <h5 class="h5--primary">{{ ingredient_title_6 }}</h5>
                            {%- if ingredient_description_6 -%}
                                {{ ingredient_description_6 }}
                            {%- endif -%}
                        {%- endif -%}

                       {%- if ingredient_title_7 -%}
                            <h5 class="h5--primary">{{ ingredient_title_7 }}</h5>
                            {%- if ingredient_description_7 -%}
                                {{ ingredient_description_7 }}
                            {%- endif -%}
                        {%- endif -%}

                        {%- if ingredient_title_8 -%}
                            <h5 class="h5--primary">{{ ingredient_title_8 }}</h5>
                            {%- if ingredient_description_8 -%}
                                {{ ingredient_description_8 }}
                            {%- endif -%}
                        {%- endif -%}

                        <div class="wayfx-product__view-ingredients">
                            <span data-fancybox data-src="#product_{{product.id}}_ingredients" data-touch="false">Full Ingredients</span>
                        </div>

                        {%- if ingredient_not_added_item_1 -%}
                            <div class="wayfx-product__not-included">
                                <!-- <h5 class="h5--primary">What we choose not to include</h5> -->
                                <ul>
                                  <li>{{ingredient_not_added_item_1}}</li>
                                  {%- if ingredient_not_added_item_2 -%}<li>{{ingredient_not_added_item_2}}</li>{%- endif -%}
                                  {%- if ingredient_not_added_item_3 -%}<li>{{ingredient_not_added_item_3}}</li>{%- endif -%}
                                  {%- if ingredient_not_added_item_4 -%}<li>{{ingredient_not_added_item_4}}</li>{%- endif -%}
                                  {%- if ingredient_not_added_item_5 -%}<li>{{ingredient_not_added_item_5}}</li>{%- endif -%}
                                  {%- if ingredient_not_added_item_6 -%}<li>{{ingredient_not_added_item_6}}</li>{%- endif -%}
                                  {%- if ingredient_not_added_item_7 -%}<li>{{ingredient_not_added_item_7}}</li>{%- endif -%}
                                  {%- if ingredient_not_added_item_8 -%}<li>{{ingredient_not_added_item_8}}</li>{%- endif -%}
                                </ul>
                            </div>
                        {%- endif -%}
                    </div>
                </li>
            {%- endif -%}
            {%- assign extra_block_heading = product.metafields.sf_product_layout_b.extra_block_heading -%}
            {%- assign extra_block_image = product.metafields.sf_product_layout_b.extra_block_image -%}
            {%- assign extra_block_item_heading_1 = product.metafields.sf_product_layout_b.extra_block_item_heading_1 -%}
            {%- assign extra_block_item_description_1 = product.metafields.sf_product_layout_b.extra_block_item_description_1 -%}
            {%- assign extra_block_item_heading_2 = product.metafields.sf_product_layout_b.extra_block_item_heading_2 -%}
            {%- assign extra_block_item_description_2 = product.metafields.sf_product_layout_b.extra_block_item_description_2 -%}
            {%- assign extra_block_item_heading_3 = product.metafields.sf_product_layout_b.extra_block_item_heading_3 -%}
            {%- assign extra_block_item_description_3 = product.metafields.sf_product_layout_b.extra_block_item_description_3 -%}
            {%- assign extra_block_cta_link = product.metafields.sf_product_layout_b.extra_block_cta_link -%}
            {%- assign extra_block_cta_text = product.metafields.sf_product_layout_b.extra_block_cta_text -%}
            {%- assign extra_block_2_image = product.metafields.sf_product_layout_b.extra_block_2_image -%}
            {%- assign extra_block_2_description = product.metafields.sf_product_layout_b.extra_block_2_description %}
            {%- assign extra_block_2_references = product.metafields.sf_product_layout_b.extra_block_references -%}
            {%- if extra_block_heading -%}
                <li class="wayfx-product__accordion-item">
                    <div class="wayfx-product__accordion-title">{{ extra_block_heading }}</div>
                    <div class="wayfx-product__accordion-content wayfx-product__accordion-content--treatments" style="display: none;">
                        {%- if extra_block_image -%}
                          <div class="wayfx-image">
                            <img width="514" height="281" loading="lazy" src="https://cdn.medik8.com/{{ extra_block_image }}/" alt="" />
                          </div>
                        {%- endif -%}
                        {%- if extra_block_item_heading_1 -%}
                          <div class="wayfx-text">
                              <h5 class="h5--primary">{{ extra_block_item_heading_1 }}</h5>
                              {{ extra_block_item_description_1 }}
                          </div>
                        {%- endif -%}
                        {%- if extra_block_item_heading_2 -%}
                          <div class="wayfx-text">
                              <h5 class="h5--primary">{{ extra_block_item_heading_2 }}</h5>
                              {{ extra_block_item_description_2 }}
                          </div>
                        {%- endif -%}
                        {%- if extra_block_item_heading_3 -%}
                          <div class="wayfx-text">
                              <h5 class="h5--primary">{{ extra_block_item_heading_3 }}</h5>
                              {{ extra_block_item_description_3 }}
                          </div>
                        {%- endif -%}
                        {%- if extra_block_cta_link -%}
                          <div class="wayfx-button">
                              <a href="{{ extra_block_cta_link }}" class="btn btn--large">{{ extra_block_cta_text }}</a>
                          </div>
                        {%- endif -%}
                    </div>
                </li>
                {%- endif -%}
                {%- if extra_block_2_description -%}
                  <li class="wayfx-product__accordion-item">
                      <div class="wayfx-product__accordion-title">{{ 'products.hero.science_behind' | t }}</div>
                      <div class="wayfx-product__accordion-content wayfx-product__accordion-content--results" style="display: none;">
                          {%- if extra_block_2_image -%}
                            <div class="wayfx-image">
                              <img width="514" height="281" loading="lazy" src="https://cdn.medik8.com/{{ extra_block_2_image }}/" alt="" />
                            </div>
                          {%- endif -%}
                          <div class="wayfx-text">
                            {{ extra_block_2_description }}
                          </div>
                          {%- if extra_block_2_references -%}
                            <div class="wayfx-references">
                                {{ extra_block_2_references }}
                            </div>
                          {%- endif -%}
                      </div>
                  </li>
                {%- endif -%}
            </ul>
    </div>
  {%- endif -%}
  </div>

  </div>
   {% render 'product.ingredients-modal',
              product_subtitle:product_subtitle,
              full_ingredient_list:full_ingredient_list,
              full_ingredient_disclaimer:full_ingredient_disclaimer
  %}
</div>

{% schema %}
    {
        "name": "Product:Hero",
        "presets": [
          {
            "name": "Product:Hero"
          }
        ],
        "templates": ["product"],
        "tag": "section",
        "class": "wayfx-product__section wayfx-product__hero",
        "settings": [
          {
            "type": "text",
            "id": "shipping_popup",
            "label": "Shipping/Delivery information"
          },
          {
            "type": "textarea",
            "id": "popup_text",
            "label": "Easy Returns Popup Text"
          },
          {
            "type": "header",
            "content": "OOS notification"
          },
          {
            "type": "checkbox",
            "id": "oos__show",
            "label": "Show email capture",
            "info": "Show the OOS email capture form. This will add the user to the stock notification flow on Klaviyo. Klaviyo API key can be found in theme settings/modules",
            "default":true
          },

          {
            "type": "text",
            "id": "oos__heading",
            "label": "Heading"
          },
          {
            "type": "richtext",
            "id": "oos__content",
            "label": "Tagline / below heading text"
          },
          {
            "type": "text",
            "id": "oos__button_text",
            "label": "Button text"
          },
          {
            "type": "richtext",
            "id": "oos__below_button__default",
            "label": "Below button (default)"
          },
          {
            "type": "richtext",
            "id": "oos__below_button__success",
            "label": "Below button (user added)"
          },
          {
            "type": "richtext",
            "id": "oos__below_button__error",
            "label": "Below button (error)"
          },
          {
            "type": "header",
            "content": "Loyalty Lion"
          },
          {
            "type": "richtext",
            "id": "loyalty_lion__hint_text",
            "label": "Hint text",
            "default":"<p>Earn 1 point for every Â£1 spent with our rewards programme, Me&amp;Medik8. Simply create an account to join. Collect points every time you shop and redeem them for rewards, including money off future purchases.<br><br>You can also enjoy lots of exclusive benefits from secret promotions, free shipping and a gift on your birthday.</p>"
          }
        ]
    }
{% endschema %}

{%- if template == 'product' -%}
    <style type="text/css">
        .wayfx-product__hero {
            background: #F5F5F5;
        }
    </style>
{%- endif -%}

{%- if template == 'product.alternate' %}
    <style type="text/css">
        .wayfx-product__photos-block {
            position: sticky;
            position: -webkit-sticky;
            top: 100px;
        }
    </style>
{%- endif -%}

<style>
  .wayfx-product__thumbnail svg {
    padding: 10px;
  }
  .product-single__media video {
    width:100%;
  }
</style>

<script>
  $(document).ready(function() {
   
    const maxPerItem = 6
    const atcMain = document.querySelector('.js-product-main-atc')
    const qtySelectorMain = document.querySelector('.js-product-main-qty')
    let allItemsErrorMessage = false

    const productVariantQtyHelper = new GlobalVariantQtyHelper({
      variantId:{{ product.selected_or_first_available_variant.id | json }},
      variantInventoryQty:parseInt({{ product.selected_or_first_available_variant.inventory_quantity | json }}),
      variantInventoryManagement:{{ product.selected_or_first_available_variant.inventory_management | json }},
      data:{
        variantTitle:{{ product.selected_or_first_available_variant.title | json }}
      }
    })

    productVariantQtyHelper.subscribe( async () => {
      const variantQtyData = await productVariantQtyHelper.getVariantData()
      //// QTY SELECTOR STATE
      // add stock to qty so we can access it in atc. TODO - better way to do this once we roll out cart / pdp i.e. call addToCart() inside form customelement and pass as param
      if(variantQtyData.managed == 'shopify'){
        qtySelectorMain.input.dataset.variantInventoryQty = variantQtyData.stock
      }
      // disable if 6 items in cart or 0 remaning
      if(!variantQtyData.remaining && variantQtyData.managed == 'shopify' || variantQtyData.cart >= maxPerItem){
        qtySelectorMain.classList.add('qty-selector-disabled')
        qtySelectorMain.input.value = 0
      // else update the max value
      }else if(variantQtyData.remaining && variantQtyData.managed == 'shopify'){
        qtySelectorMain.classList.remove('qty-selector-disabled')
        let remaining = maxPerItem - variantQtyData.cart 
        remaining = variantQtyData.remaining < remaining ? variantQtyData.remaining : remaining
        qtySelectorMain.input.setAttribute('max' , remaining)
        qtySelectorMain.input.value = qtySelectorMain.input.value > qtySelectorMain.input.max ? qtySelectorMain.input.max : qtySelectorMain.input.value == 0 ? 1 : qtySelectorMain.input.value
      }
      // fire the qty input events in case it has subsrcribers
      qtySelectorMain.input.dispatchEvent(new Event('change'))
      qtySelectorMain.next()
      //// BUTTON / MESSAGE STATE
      // create the error message
      if(!allItemsErrorMessage){
        allItemsErrorMessage = parseHTML(`
          <button 
            type="button" 
            style="display:none;text-align:center;width:100%;padding:12px;text-decoration:underline;color: #000;background-color: #fff;" 
            class="js-product-qty-errors note btn-reset"></button>
        `)
        atcMain.closest('form').append(allItemsErrorMessage)
        allItemsErrorMessage = document.querySelector('.js-product-qty-errors')
        // show the cart on click ... TODO: add observable pattern to sidebar cart once we move observer from global / import > inline / init load
        allItemsErrorMessage.addEventListener( 'click' , () => {
          window.globalSideBarUI__cart.open()
        })
      }
      // show error if 6 already in cart
      const variantTitle = variantQtyData.data.variantTitle == 'Default Title' ? 'this item' : variantQtyData.data.variantTitle
      {% assign variant_title_templatestring = '${variantTitle}'%}
      if(variantQtyData.cart == maxPerItem){
        atcMain.disabled = true
        {% assign max_templatestring = '${maxPerItem}'%}
        allItemsErrorMessage.innerText = `{{ 'general.stock.max_per_order' | t: max: max_templatestring, variant_title: variant_title_templatestring }}`
        allItemsErrorMessage.style.display = 'block'   
      // show error if all items in the cart
      }else if(variantQtyData.stock <= variantQtyData.cart && variantQtyData.managed == 'shopify'){
        atcMain.disabled = true
        allItemsErrorMessage.innerText = `{{ 'general.stock.max_stock' | t: variant_title: variant_title_templatestring }}`
        allItemsErrorMessage.style.display = 'block'  
      }else{
        // update button and hide error notification
        atcMain.disabled = false
        if(allItemsErrorMessage){
          allItemsErrorMessage.style.display = 'none'
        }
      }
    })

    $('.wayfx-product__featured-photo').slick({
      slidesToShow: 1,
      slidesToScroll: 1,
      arrows: false,
      draggable: false,
      fade: true,
      asNavFor: '.wayfx-product__thumbnails'
    }).addClass('loaded');

    $('.wayfx-product__thumbnails').slick({
      slidesToShow: 4,
      slidesToScroll: 1,
      asNavFor: '.wayfx-product__featured-photo',
      dots: false,
      arrows: false,
      focusOnSelect: true,
      variableWidth: true
    }).show();

    $(".wayfx-product__thumbnail").on( "click", function() {
        $('.product-single__media video').get(0).pause()
    });

    $(".wayfx-product__accordion-title").on( "click", function() {
      $(this).parent().toggleClass('wayfx-product__accordion-item--open');
      $(this).next('.wayfx-product__accordion-content').slideToggle(100);
    });

    $('#productSelect').change(function() {
      var $option = $(this).find('option:selected'),
          value = $option.data('image-id'),
          low_stock = $option.data('low-stock'),
          price = $option.data('price'),
          discounted_price = $option.data('discounted-price'),
          thumbnail_image = $('.wayfx-product__thumbnails .variant-image-' + value);
  
          const qtyHelperParams = {
            variantId:$option.data('variant-id'),
            variantInventoryQty:$option.data('variant-inventory-qty'),
            variantInventoryManagement:$option.data('variant-inventory-management'),
            data:{
              variantTitle:$option.data('variant-title'),
            }
          }
          productVariantQtyHelper.updateSettings(qtyHelperParams)


      {% comment %} @TODO to be reviewed - the refresh on gift cards does not make sense. Interferes with the discount mechanism  {% endcomment %}
      {% if productIsGiftCard %}
        window.location.search = '?variant=' + $option.val();
      {% endif %}

      // Fixes wishlist on browsers that support pushstate

        {% comment %} if (window.history.pushState) {
            var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?variant=' + $option.val();
            window.history.pushState({path:newurl},'',newurl);
        } {% endcomment %}


      if(low_stock === 'true') {
        $('.wayfx-product__low-stock-wrap').show();
      } else {
        $('.wayfx-product__low-stock-wrap').hide();
      }

      $('#ProductPrice').text(price);
      $('#DiscountedPrice').text(discounted_price);

      {% comment %} {% if current_variant.compare_at_price >= current_variant.price %}
        $('#ProductPrice').text(discounted_price);
        $('#DiscountedPrice').text(price);
      {% else %}
        $('#ProductPrice').text(price);
      {% endif %} {% endcomment %}
      

      thumbnail_image.each(function(){
        var thumbnail_id = parseInt($(this).data('slick-index'));
        if(thumbnail_id > -1) {
          $('.wayfx-product__thumbnails').slick('slickGoTo', thumbnail_id);
        }
      });
    });

    {% unless productIsGiftCard %}
    const $AddToCart = $('#AddToCart')
    const $AddToCartDisabled = $('#AddToCartDisabled')
        $('#productSelect').change(function() {

          let priceBox = $("#ProductPrice");
          let discountLabel = $("#DiscountLabel");
          let discountBox = $("#DiscountedPrice");

          var $option = $(this).find('option:selected'),
          price = $option.data('price'),
          discounted_price = $option.data('discounted-price');

          if(discounted_price) {
            discountBox.show();
            discountLabel.show();
            priceBox.addClass('slashed-price');
            discountBox.text(discounted_price);
          } else {
            discountBox.hide();
            discountLabel.hide();
            priceBox.removeClass('slashed-price');
            priceBox.text(price);
          }

          // if variant is out of stock 
          const outOfStock = $option.attr('data-disabled') ? true : false
          $AddToCart.toggle(!outOfStock)
          $AddToCart.prop('disabled',outOfStock)
          $AddToCartDisabled.toggle(outOfStock)
        })
    {% endunless%}

    if (window.location.href.indexOf('?variant=') > 0) {
      let searchParams = new URLSearchParams(window.location.search);
      var variant_id = searchParams.get('variant'),
          thumbnail_image = $('.wayfx-product__thumbnails .variant-id-' + variant_id);
          thumbnail_image.each(function(){
        var thumbnail_id = parseInt($(this).data('slick-index'));
        if(thumbnail_id > -1) {
          $('.wayfx-product__thumbnails').slick('slickGoTo', thumbnail_id);
        }
      });
    }
  });

</script>
